version: '3.8'

services:
  # AI Agent service - connects to existing Ollama
  agent:
    build:
      context: .
      dockerfile: Dockerfile.agent
    container_name: ai-agent
    volumes:
      - ./state:/app/state
      - ./logs:/app/logs
      - ./instructions:/app/instructions
      - ./.strava_cookies:/app/.strava_cookies:ro
      - ./.strava_token:/app/.strava_token:ro
      - ./config.yaml:/app/config.yaml:ro
    networks:
      - ollama-network
    environment:
      - PYTHONUNBUFFERED=1
      - STRAVA_CLIENT_ID=${STRAVA_CLIENT_ID}
      - STRAVA_CLIENT_SECRET=${STRAVA_CLIENT_SECRET}
    env_file:
      - .env
    restart: unless-stopped
    # Command options:
    # - Run once: command: python main.py --once
    # - Run specific instruction: command: python main.py --instruction "Strava Activity Monitor"
    # - Run scheduler (default): command: python main.py

networks:
  ollama-network:
    external: true
    name: ${DOCKER_NETWORK:-ollama-network}
